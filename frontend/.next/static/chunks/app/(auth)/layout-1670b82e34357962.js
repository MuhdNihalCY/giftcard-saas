(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[695],{80357:function(e,t,r){Promise.resolve().then(r.bind(r,24469))},99376:function(e,t,r){"use strict";var s=r(35475);r.o(s,"useParams")&&r.d(t,{useParams:function(){return s.useParams}}),r.o(s,"usePathname")&&r.d(t,{usePathname:function(){return s.usePathname}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}})},24469:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u}});var s=r(57437),n=r(2265),a=r(99376),o=r(1217);function u(e){let{children:t}=e,u=(0,a.useRouter)(),c=(0,a.usePathname)(),{isAuthenticated:i,checkAuth:l}=(0,o.t)();return(0,n.useEffect)(()=>{l();{let e=localStorage.getItem("accessToken"),t=localStorage.getItem("user");if(e&&t)try{let e=JSON.parse(t);Promise.resolve().then(r.bind(r,68123)).then(t=>{let{auth:r}=t;if(!r.isAccessTokenExpired()&&("/login"===c||"/register"===c)){let t="ADMIN"===e.role||"MERCHANT"===e.role?"/dashboard":"/";window.location.replace(t)}})}catch(e){console.error("Error checking auth:",e)}}if(i){let e=o.t.getState().user;if(e&&("/login"===c||"/register"===c)){let t="ADMIN"===e.role||"MERCHANT"===e.role?"/dashboard":"/";window.location.href=t}}},[i,c,u,l]),(0,s.jsx)(s.Fragment,{children:t})}},71837:function(e,t,r){"use strict";var s=r(83464),n=r(68123);let a="http://localhost:8000/api/v1",o=s.Z.create({baseURL:a,headers:{"Content-Type":"application/json"}}),u=!1,c=[],i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;c.forEach(r=>{e?r.reject(e):r.resolve(t)}),c=[]};o.interceptors.request.use(e=>{let t=n.auth.getAccessToken();return t&&e.headers&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),o.interceptors.response.use(e=>e,async e=>{var t;let r=e.config;if((null===(t=e.response)||void 0===t?void 0:t.status)===401&&!r._retry){if(u)return new Promise((e,t)=>{c.push({resolve:e,reject:t})}).then(e=>(r.headers&&e&&(r.headers.Authorization="Bearer ".concat(e)),o(r))).catch(e=>Promise.reject(e));r._retry=!0,u=!0;let t=n.auth.getRefreshToken();if(!t)return n.auth.clear(),window.location.href="/login",Promise.reject(e);try{let{accessToken:e,refreshToken:u}=(await s.Z.post("".concat(a,"/auth/refresh"),{refreshToken:t})).data.data;return n.auth.setTokens(e,u||t),r.headers&&(r.headers.Authorization="Bearer ".concat(e)),i(null,e),o(r)}catch(e){return i(e,null),n.auth.clear(),window.location.href="/login",Promise.reject(e)}finally{u=!1}}return Promise.reject(e)}),t.Z=o},68123:function(e,t,r){"use strict";r.r(t),r.d(t,{auth:function(){return n}});var s=r(14474);let n={setTokens(e,t){localStorage.setItem("accessToken",e),localStorage.setItem("refreshToken",t)},getAccessToken:()=>localStorage.getItem("accessToken"),getRefreshToken:()=>localStorage.getItem("refreshToken"),isAccessTokenExpired(){let e=this.getAccessToken();if(!e)return!0;try{let t=(0,s.o)(e),r=Date.now()/1e3;return t.exp<r}catch(e){return!0}},isRefreshTokenExpired(){let e=this.getRefreshToken();if(!e)return!0;try{let t=(0,s.o)(e),r=Date.now()/1e3;return t.exp<r}catch(e){return!0}},getTokenExpiration(e){try{let t=(0,s.o)(e);return 1e3*t.exp}catch(e){return null}},setUser(e){localStorage.setItem("user",JSON.stringify(e))},getUser(){{let e=localStorage.getItem("user");return e?JSON.parse(e):null}},getUserFromToken(){let e=this.getAccessToken();if(!e)return null;try{return(0,s.o)(e)}catch(e){return null}},clear(){localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("user")},isAuthenticated(){return!!this.getAccessToken()&&!this.isAccessTokenExpired()},validateTokens(){let e=this.getAccessToken(),t=this.getRefreshToken();if(!e||!t)return{valid:!1,needsRefresh:!1};let r=this.isAccessTokenExpired();return this.isRefreshTokenExpired()?{valid:!1,needsRefresh:!1}:r?{valid:!1,needsRefresh:!0}:{valid:!0,needsRefresh:!1}}}},1217:function(e,t,r){"use strict";r.d(t,{t:function(){return u}});var s=r(59625),n=r(89134),a=r(68123),o=r(71837);let u=(0,s.Ue)()((0,n.tJ)(e=>({user:null,isAuthenticated:!1,setUser:t=>{a.auth.setUser(t),e({user:t,isAuthenticated:!0}),localStorage.setItem("user",JSON.stringify(t))},setTokens:(e,t)=>{a.auth.setTokens(e,t);{let r=localStorage.getItem("accessToken");r&&r===e||(console.warn("Token storage verification failed, retrying..."),localStorage.setItem("accessToken",e),localStorage.setItem("refreshToken",t))}},clearAuth:()=>{a.auth.clear(),e({user:null,isAuthenticated:!1})},checkAuth:()=>{let t=a.auth.validateTokens();if(!t.valid){t.needsRefresh?u.getState().refreshToken():(a.auth.clear(),e({user:null,isAuthenticated:!1}));return}e({user:a.auth.getUser(),isAuthenticated:a.auth.isAuthenticated()})},refreshToken:async()=>{let t=a.auth.getRefreshToken();if(!t||a.auth.isRefreshTokenExpired())return a.auth.clear(),e({user:null,isAuthenticated:!1}),!1;try{let{accessToken:r,refreshToken:s,user:n}=(await o.Z.post("/auth/refresh",{refreshToken:t})).data.data;return a.auth.setTokens(r,s||t),n?(a.auth.setUser(n),e({user:n,isAuthenticated:!0})):e({isAuthenticated:!0}),!0}catch(t){return a.auth.clear(),e({user:null,isAuthenticated:!1}),!1}}}),{name:"auth-storage",storage:(0,n.FL)(()=>localStorage)}))}},function(e){e.O(0,[405,883,971,117,744],function(){return e(e.s=80357)}),_N_E=e.O()}]);